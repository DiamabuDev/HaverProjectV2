@{
    ViewData["Title"] = "Home Page";
}

<div class="dashboard mt-3">
    @if (User.IsInRole("Admin"))
    {
        <div class="container">
            <div class="row">
                <div class="col-5 mb-3">
                    <h2>Hello @ViewBag.FirstName @ViewBag.LastName, <span class="badge bg-secondary">@ViewBag.Role</span></h2>
                </div>
            </div>
            <div class="row">
                <div class="col-3 mb-5">
                    <a class="dashboard-item text-decoration-none bg-primary text-white" asp-area="" asp-controller="Ncr" asp-action="Index">
                        <i class="bi bi-file-earmark-spreadsheet"></i>
                        <p>NCR Log</p>
                    </a>
                </div>            
                <div class="col-3 mb-5">
                    <div class="dropdown">
                        <a role="button" href="#" id="adminDropdown" data-bs-toggle="dropdown" aria-expanded="false" class="dashboard-item dropdown-with text-decoration-none bg-primary text-white">
                            <i class="bi bi-building-gear"></i>
                            <p class="dropdown-toggle">
                                Sections
                            </p>
                        </a>
                        <ul class="dropdown-menu custom-dropdown-color" aria-labelledby="adminDropdown">
                            <li><a class="dropdown-item" asp-area="" asp-controller="NcrQa" asp-action="Index">Quality</a></li>
                            <li><a class="dropdown-item" asp-area="" asp-controller="NcrEng" asp-action="Index">Engineer</a></li>
                            <li><a class="dropdown-item" asp-area="" asp-controller="NcrOperation" asp-action="Index">Operations</a></li>
                            <li><a class="dropdown-item" asp-area="" asp-controller="NcrProcurement" asp-action="Index">Procurement</a></li>
                            <li><a class="dropdown-item" asp-area="" asp-controller="NcrReInspect" asp-action="Index">ReInspection</a></li>
                        </ul>
                    </div>
                </div>
                <div class="col-3">
                    <a class="dashboard-item text-decoration-none bg-primary text-white" asp-area="" asp-controller="Supplier" asp-action="Index">
                        <i class="bi bi-buildings"></i>
                        <p>Suppliers</p>
                    </a>
                </div>
            </div>
            <div class="row">
                <div class="col-3">
                    <a class=" dashboard-item text-decoration-none bg-primary text-white" asp-area="" asp-controller="UserRole" asp-action="Index">
                        <i class="bi bi-buildings"></i>
                        <p>Users</p>
                    </a>
                </div>
                <div class="col-3">
                    <a class="dashboard-item text-decoration-none custom-bg-dashboard-item bg-secondary" asp-area="" asp-controller="" asp-action="">
                        <i class="bi bi-graph-down"></i>
                        <p>KPI Dashboard</p>
                    </a>
                </div>
                <div class="col-3">
                    <div class="dropdown">
                        <a role="button" href="#" id="adminDropdown" data-bs-toggle="dropdown" aria-expanded="false" class="dashboard-item dropdown-with text-decoration-none bg-primary text-white">
                            <i class="bi bi-building-gear"></i>
                            <p class="dropdown-toggle">
                                Administrator
                            </p>
                        </a>
                        <ul class="dropdown-menu custom-dropdown-color" aria-labelledby="adminDropdown">
                            <li><a class="dropdown-item" asp-area="" asp-controller="Item" asp-action="Index">Items</a></li>
                            <li><a class="dropdown-item" asp-area="" asp-controller="Defects" asp-action="Index">Defect Types</a></li>
                            <li><a class="dropdown-item" asp-area="" asp-controller="Lookup" asp-action="Index">Lookup Values</a></li>
                        </ul>
                    </div>
                </div>
            </div>
        </div>
    }

    @if (User.IsInRole("Quality"))
    {
        <div>
            <div class="row mb-3">
                <div class="col-md-12">
                    <h2>Hello @ViewBag.FirstName @ViewBag.LastName, <span class="badge bg-secondary">@ViewBag.Role</span></h2>
                </div>
            </div>
            <div class="row">
                <div class="col-md-3 mb-5">
                    <div class="dashboard-item text-decoration-none bg-warning text-white">
                        <i class="bi bi-bell-fill"></i>
                        <p id="pendingCountReInsp"></p>
                    </div>
                </div>
                <div class="col-md-4">
                </div>
                <div class="col-md-3 mb-5">
                    <a class="dashboard-item newncr text-decoration-none bg-success text-white" asp-area="" asp-controller="NcrQa" asp-action="Create">
                        <i class="bi bi-file-earmark-plus"></i>
                        <p>New NCR</p>
                    </a>
                </div>          
            </div>
            <div class="row">
                <div class="col-md-3">
                    <a class="dashboard-item text-decoration-none bg-primary text-white" asp-area="" asp-controller="NcrQa" asp-action="Index">
                        <i class="bi bi-file-earmark-spreadsheet"></i>
                        <p>NCR Quality Log</p>
                    </a>
                </div>
                <div class="col-md-4">
                </div>
                <div class="col-md-3">
                    <a class="dashboard-item text-decoration-none bg-primary text-white" asp-area="" asp-controller="NcrReInspect" asp-action="Index">
                        <i class="bi bi-file-earmark-spreadsheet"></i>
                        <p>NCR ReInspection Log</p>
                    </a>
                </div>
            </div>
        </div>
    }
    @if (User.IsInRole("Engineer"))
    {
        <div>
            <div class="row mb-3">
                <div class="col-md-12">
                    <h2>Hello @ViewBag.FirstName @ViewBag.LastName, <span class="badge bg-secondary">@ViewBag.Role</span></h2>
                </div>
            </div>
            <div class="row">
                <div class="col-md-3">
                    <div class="dashboard-item text-decoration-none bg-warning text-white">
                        <i class="bi bi-bell-fill"></i>
                        <p id="pendingCountEng"></p>
                    </div>
                </div>
                <div class="col-md-4">
                </div>
                <div class="col-md-3">
                    <a class="dashboard-item text-decoration-none bg-primary text-white" asp-area="" asp-controller="NcrEng" asp-action="Index">
                        <i class="bi bi-file-earmark-spreadsheet"></i>
                        <p>NCR Log</p>
                    </a>
                </div>
            </div>
        </div>
    }
    @if (User.IsInRole("Operations"))
    {
        <div>
            <div class="row mb-3">
                <div class="col-md-12">
                    <h2>Hello @ViewBag.FirstName @ViewBag.LastName, <span class="badge bg-secondary">@ViewBag.Role</span></h2>
                </div>
            </div>
            <div class="row">
                <div class="col-md-3">
                    <div class="dashboard-item text-decoration-none bg-warning text-white">
                        <i class="bi bi-bell-fill"></i>
                        <p id="pendingCountOp"></p>
                    </div>
                </div>
                <div class="col-md-4">
                </div>
                <div class="col-md-3">
                    <a class="dashboard-item text-decoration-none bg-primary text-white" asp-area="" asp-controller="NcrOperation" asp-action="Index">
                        <i class="bi bi-file-earmark-spreadsheet"></i>
                        <p>NCR Log</p>
                    </a>
                </div>
            </div>
        </div>
    }
    @if (User.IsInRole("Procurement"))
    {
        <div>
            <div class="row mb-3">
                <div class="col-md-12">
                    <h2>Hello @ViewBag.FirstName @ViewBag.LastName, <span class="badge bg-secondary">@ViewBag.Role</span></h2>
                </div>
            </div>
            <div class="row">
                <div class="col-md-3">
                    <div class="dashboard-item text-decoration-none bg-warning text-white">
                        <i class="bi bi-bell-fill"></i>
                        <p id="pendingCountProc"></p>
                    </div>
                </div>
                <div class="col-md-4">
                </div>
                <div class="col-md-3">
                    <a class="dashboard-item text-decoration-none bg-primary text-white" asp-area="" asp-controller="NcrProcurement" asp-action="Index">
                        <i class="bi bi-file-earmark-spreadsheet"></i>
                        <p>NCR Log</p>
                    </a>
                </div>
            </div>
        </div>
    }
</div>
@section Scripts {

    <script src="~/lib/jquery-validation/dist/jquery.validate.min.js"></script>
    <script src="~/lib/jquery-validation-unobtrusive/jquery.validate.unobtrusive.min.js"></script>
    <script src="~/js/NcrPending.js"></script>

        <script>
            var section;
        </script>
    @if (User.IsInRole("Admin"))
    {
        <script>
            section = "NcrReInspect"
            function updatePendingCountReInsp(section) {
                $.ajax({
                    url: '@Url.Action("GetPendingCount", "NcrReInspect")',
                    type: 'GET',
                    success: function (data) {
                        $('#pendingCountReInsp').html('Pending NCRs for ReInspection:  ' + data);
                    },
                    error: function () {
                        console.error('Error fetching pending count');
                    }
                });
            }

            $(document).ready(function () {
                updatePendingCountReInsp();
            });
        </script>
    }
    @if (User.IsInRole("Engineer"))
    {
        <script>
            section = "NcrEng"
            function updatePendingCountEng(section) {
                $.ajax({
                    url: '@Url.Action("GetPendingCount", "NcrEng")',
                    type: 'GET',
                    success: function (data) {
                        $('#pendingCountEng').html("Pending NCRs: " + data);
                    },
                    error: function (xhr, status, error) {
                        alert('Error fetching data for NcrEng. Status: ' + status + '. Error: ' + error);
                    }
                });
            }

            $(document).ready(function () {
                updatePendingCountEng();
            });
        </script>
        }
@if (User.IsInRole("Operations"))
{
    <script>
        section = "NcrOperation"
            function updatePendingCountOp(section) {
                $.ajax({
                    url: '@Url.Action("GetPendingCount", "NcrOperation")',
                    type: 'GET',
                    success: function (data) {
                        $('#pendingCountOp').html('Pending NCRs:' + data);
                    },
                error: function () {
                    console.error('Error fetching pending count');
                }
                });
            }

            $(document).ready(function () {
                updatePendingCountOp();
            });
        </script>
        }
    @if (User.IsInRole("Procurement"))
    {
        <script>
            section = "NcrProcurement"
            function updatePendingCountProc(section) {
                $.ajax({
                    url: '@Url.Action("GetPendingCount", "NcrProcurement")',
                    type: 'GET',
                    success: function (data) {
                        $('#pendingCountProc').html('Pending NCRs:  ' + data);
                    },
                    error: function () {
                        console.error('Error fetching pending count');
                    }
                });
            }

            $(document).ready(function () {
                updatePendingCountProc();
            });
        </script>
        }
@if (User.IsInRole("Quality"))
    {
        <script>
            section = "NcrReInspect"
            function updatePendingCountReInsp(section) {
                $.ajax({
                    url: '@Url.Action("GetPendingCount", "NcrReInspect")',
                    type: 'GET',
                    success: function (data) {
                        $('#pendingCountReInsp').html('Pending NCRs for ReInspection:  ' + data);
                    },
                    error: function () {
                        console.error('Error fetching pending count');
                    }
                });
            }

            $(document).ready(function () {
                updatePendingCountReInsp();
            });
        </script>   
        }
}